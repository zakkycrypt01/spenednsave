Smart Contract Requirements SpecificationProject: SpendGuardNetwork: Base (EVM Compatible)Solidity Version: ^0.8.201. OverviewThe system consists of two interacting contracts:GuardianSBT.sol: A non-transferable NFT contract that defines who is a Guardian.SpendVault.sol: The treasury contract that holds funds and verifies signatures against the GuardianSBT list.2. Contract A: GuardianSBT.sol (Identity Layer)Standard: ERC-721 (Soulbound)Library Dependencies: OpenZeppelin (ERC721, Ownable)2.1 Core LogicSoulbound: The token must not be transferable between wallets. Friends cannot sell or give away their voting power.Admin Controlled: Only the Owner (The Saver) can mint or burn tokens.2.2 Key FunctionsFunction NameVisibilityLogic Descriptionmint(address to)onlyOwnerMints a new NFT to a friend's address. Represents adding a Guardian.burn(uint256 tokenId)onlyOwnerBurns a specific NFT. Represents firing a Guardian._update (or transfer)overrideCRITICAL: Override the standard transfer logic. If from != 0 (mint) and to != 0 (burn), the transaction must revert. This enforces the "Soulbound" property.3. Contract B: SpendVault.sol (Treasury Layer)Standard: Custom Vault + EIP-712Library Dependencies: OpenZeppelin (IERC20, Ownable, EIP712, ECDSA, ReentrancyGuard)3.1 State Variablesaddress public guardianToken: Address of the GuardianSBT contract.uint256 public quorum: The number of valid signatures required (e.g., 2).uint256 public nonce: A counter that increments after every successful withdrawal. Prevents Replay Attacks (so a friend's signature can't be used twice).3.2 Key FunctionsA. ManagementFunction NameVisibilityLogic DescriptionsetQuorum(uint256 _newQuorum)onlyOwnerUpdates the number of required signatures.updateGuardianToken(address _newAddress)onlyOwner(Optional) Allows swapping the NFT contract if you deploy a V2.B. Funding (In & Out)Function NameVisibilityLogic Descriptionreceive() / fallback()externalAllows the contract to accept native ETH (Base ETH).deposit(address token, uint amount)externalHelper for depositing ERC-20 tokens (USDC, DEGEN).C. Withdrawal (The Core Logic)Function Signature:withdraw(address token, uint256 amount, address recipient, string memory reason, bytes[] memory signatures)Execution Logic (Step-by-Step):Rebuild Hash: Create the EIP-712 struct hash using amount, token, recipient, nonce, and reason.Verify Quorum: Check if signatures.length >= quorum.Signature Loop: Iterate through the signatures array:Recover the signer's address using ECDSA.recover.Check 1: Does GuardianSBT.balanceOf(signer) > 0? If no, revert.Check 2: Has this signer already been counted in this loop? (Prevent duplicates).Transfer: If all checks pass:Increment nonce (nonce++).Transfer amount of token to recipient.4. EIP-712 Typed Data StructureTo ensure the user sees a readable message in their wallet (not just hex codes), the contract and frontend must agree on this specific data structure:Solidity// Domain Separator
string private constant SIGNING_DOMAIN = "SpendGuard";
string private constant SIGNING_VERSION = "1";

// The "Type" Hash
bytes32 private constant WITHDRAWAL_TYPEHASH = keccak256(
    "Withdrawal(address token,uint256 amount,address recipient,uint256 nonce,string reason)"
);
5. Security Requirements (Checklist)Reentrancy Guard: Use nonReentrant on the withdraw function to prevent recursive calling attacks.Zero Address Check: Ensure recipient is not address(0).Nonce usage: Ensure nonce is included in the signed message hash. This guarantees that a signature for "Withdrawal #5" cannot be used for "Withdrawal #6".Ownership: The SpendVault owner should be the Saver's main wallet.6. Optional: The "Emergency Escape" (Timelock)If you want the "Rage Quit" feature (withdrawing without friends in an emergency), add these variables:uint256 public unlockRequestTime;uint256 public constant TIMELOCK_DURATION = 30 days;Functions:requestEmergencyUnlock(): Sets unlockRequestTime = block.timestamp.executeEmergencyUnlock(): Checks if block.timestamp >= unlockRequestTime + TIMELOCK_DURATION. If true, allow onlyOwner to withdraw everything without signatures.